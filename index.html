<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <!-- set styles on the top -->
    <style>
        .chart-container {
            max-width: 1050px;
            /* border: 2px solid red; */
            margin: 0 auto;
            /* auto centers the div */
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        }

        svg {
            overflow: visible;
        }

        h1 {
            margin: 0 auto;
        }

        .x .domain {
            display: none;
        }

        .y .domain {
            display: none;
        }

        svg .tick > text {
            font-size: small
        }

        .source {
            max-width: 1000px;
            margin: 0 auto;
        }

        #box1 {
            width:25%;
            height:0;
            padding-bottom: 25%;
            margin:0px;
            margin-left:0%;
            background:rgb(255, 165, 0, 0.4);
            text-align: center;
        }

        #box2 {
            width:25%;
            height:0;
            padding-bottom: 25%;
            margin:0px;
            margin-right:25%;
            background:rgb(255, 165, 0, 0.6);
            text-align: center;
        }

        #box3 {
            width:25%;
            height:0;
            padding-bottom: 25%;
            margin:0px;
            margin-left:0%;
            background:rgb(255, 165, 0, 0.8);
            text-align: center;
        }

        #box4 {
            width:25%;
            height:0;
            padding-bottom: 25%;
            margin:0px;
            margin-right:25%;
            background:rgb(255,165,0);
            text-align: center;
        }

        #boxTop1 {
            width:25%;
            height:25%;
            margin:0px;
            margin-left:0%;
            background:white;
        }

        #boxTop2 {
            width:25%;
            height:25%;
            margin:0px;
            margin-right:25%;
            background:white;
        }

        #boxTopLeft {
            width:10%;
            height:25%;
            margin:0px;
            margin-left:15%;
            background:white;
        }

        .boxLeft {
            width:10%;
            height:0;
            padding-bottom: 10%;
            margin:0px;
            margin-left:15%;
            background:white;
        }

        h2, p  {
            padding:5px;
        }

        #box1 p, #box2 p {
            white-space:pre;
            font-size:smaller;
            font-family:monospace;
        }
    </style>

</head>

<body>

    <div class="chart-container">
        <h1 class="headline">
            What to do with Kentucky's CSFRF budget after an unexpected funds cut?
            <br/>
            <br/>
        </h1>

        <div>
            <h2 class="headline">
                CSFRF funds cut invalidated the Governor's original budget
            </h2>

            <h3>
                Gov. Andy Beshear presented a plan to legislative leaders in March 2021, outlining how the state should spend the $2.4 billion of Coronavirus State Fiscal Recovery Fund (CSFRF) coming to Kentucky from the American Rescue Plan Act (ARPA) passed by Congress. The plan consists of infrastructure projects, paying back the federal unemployment insurance loan and direct aid to households, business and nonprofits affected by the COVID-19 pandemic.
                <br/><br/>
                However, The funds was later unexpectedly cut to $2.18 billion due to "Kentucky's well performance on reducing unemployment so far". The plan was hence invalidated and we need a new plan to allocate this fund, probably based on the current plan. 
                <br/><br/> 
                Kentucky still received a great amount of funds from CSFRF after this cut, ranked middle among all states. However, this amount is relatively low compared to the state spending, and the proportion ranked 48 among all states. Considering the fact that Kentucky’s general fund revenue and expenditure condition were seriously affected by the pandemic (In FY20, total general fund revenue only increased by 1.5% and total general fund expenditure dropped the first time in the past 10 years). Now that the funds play a different role from general funds, and become particularly pivotal in this uncommon year, we should reconsider our plan.
                <br/><br/> 
            </h3>
        
            <svg width="1050px" height="575px" id="svg1">
            </svg>
            <p class="source">Source: US Department of the Treasury</p>
            <br/><br/><br/>
        </div>
    </div>

    <div class="chart-container">
        <svg width="1050px" height="575px" id="svg2">
        </svg>
        <p class="source">Source: US Department of the Treasury, NASBO </p>
        <br/><br/><br/>
    </div>

    <div class="chart-container">

        <h2 class="headline">
            The unemployment is not that good and reflects serious structrual problem
        </h2>

        <h3>
            It is worth noting that Kentucky's unemployment situation is not that good, even though the federal cut the funds for this reason. Kentucky’s unemployment level was in line with the nationwide level before the pandemic, and showed greater resilience during the pandemic. While the short-term employment level bounced back perfectly and almost matched with the pre-pandemic level, the state has an extremely low level of labor participation rate and serious long-term structrual problem, which impede further recovery. Our priority is hence converted from short-term recovery to long-term recovery and equity.
        </h3>

        <br/><br/>

        <svg width='1050px' height='575px' id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 369.21 195.2"><defs><style>.cls-1,.cls-16,.cls-2,.cls-3,.cls-4,.cls-7{fill:none;}.cls-1{stroke:#ebebeb;stroke-dasharray:1 1;}.cls-1,.cls-2,.cls-3,.cls-4,.cls-6,.cls-7{stroke-linejoin:round;}.cls-2,.cls-3{stroke:#ff8c00;}.cls-2,.cls-4{stroke-width:1.5px;}.cls-3{stroke-width:0.5px;stroke-dasharray:2 1;}.cls-4{stroke:#5584ff;}.cls-5,.cls-8{font-size:7px;}.cls-12,.cls-13,.cls-14,.cls-15,.cls-5,.cls-8,.cls-9{font-family:Helvetica;}.cls-6,.cls-7{stroke:#333;}.cls-7{stroke-width:1.07px;}.cls-8{fill:#4d4d4d;}.cls-13,.cls-9{font-size:6px;}.cls-10{letter-spacing:-0.02em;}.cls-11{letter-spacing:-0.07em;}.cls-12,.cls-14,.cls-15{font-size:8px;}.cls-12,.cls-13{fill:#ff8c00;}.cls-14{fill:#5584ff;}.cls-16{stroke:#000;stroke-miterlimit:10;stroke-width:0.25px;}</style></defs><line class="cls-1" y1="150.42" x2="354.04" y2="150.42"/><line class="cls-1" y1="119.1" x2="354.04" y2="119.1"/><line class="cls-1" y1="87.78" x2="354.04" y2="87.78"/><line class="cls-1" y1="56.47" x2="354.04" y2="56.47"/><line class="cls-1" y1="25.15" x2="354.04" y2="25.15"/><polyline class="cls-2" points="19.87 139.98 29.53 142.07 39.19 142.07 48.85 143.11 58.5 143.11 68.16 144.15 77.82 144.15 87.48 143.11 97.14 145.2 106.79 144.15 116.45 144.15 126.11 144.15 135.77 145.2 145.43 145.2 155.08 135.8 164.74 27.24 174.4 42.9 184.06 65.86 193.72 75.26 203.37 94.05 213.03 100.31 222.69 109.71 232.35 111.79 242.01 111.79 251.67 115.97 261.32 117.01 270.98 119.1 280.64 118.06 290.3 121.19 299.96 120.14 309.61 125.36 319.27 127.45 328.93 131.63 338.59 133.71 348.25 137.89"/><polyline class="cls-3" points="19.87 145.2 29.53 148.33 39.19 147.29 48.85 148.33 58.5 147.29 68.16 147.29 77.82 147.29 87.48 146.24 97.14 148.33 106.79 147.29 116.45 147.29 126.11 149.37 135.77 150.42 145.43 150.42 155.08 141.02 164.74 34.55 174.4 53.34 184.06 76.3 193.72 85.7 203.37 104.49 213.03 108.66 222.69 119.1 232.35 120.14 242.01 119.1 251.67 122.23 261.32 123.28 270.98 125.36 280.64 126.41 290.3 128.5 299.96 127.45 309.61 131.63 319.27 134.76 328.93 137.89 338.59 139.98 348.25 143.11"/><polyline class="cls-3" points="19.87 109.71 29.53 108.66 39.19 113.88 48.85 112.84 58.5 118.06 68.16 119.1 77.82 123.28 87.48 127.45 97.14 125.36 106.79 123.28 116.45 122.23 126.11 117.01 135.77 118.06 145.43 119.1 155.08 110.75 164.74 7.41 174.4 7.41 184.06 22.02 193.72 31.42 203.37 48.12 213.03 56.47 222.69 68.99 232.35 74.21 242.01 78.39 251.67 85.7 261.32 78.39 270.98 81.52 280.64 80.48 290.3 86.74 299.96 85.7 309.61 96.14 319.27 89.87 328.93 99.27 338.59 99.27 348.25 111.79"/><polyline class="cls-4" points="19.87 137.89 29.53 138.93 39.19 138.93 48.85 138.93 58.5 138.93 68.16 138.93 77.82 138.93 87.48 138.93 97.14 138.93 106.79 139.98 116.45 139.98 126.11 139.98 135.77 139.98 145.43 138.93 155.08 138.93 164.74 9.49 174.4 50.2 184.06 128.5 193.72 122.23 203.37 127.45 213.03 128.5 222.69 130.58 232.35 130.58 242.01 130.58 251.67 131.63 261.32 132.67 270.98 132.67 280.64 132.67 290.3 132.67 299.96 131.63 309.61 131.63 319.27 131.63 328.93 132.67 338.59 133.71 348.25 133.71"/><text class="cls-5" transform="translate(0.14 148.65)">3%</text><text class="cls-5" transform="translate(0.14 117.33)">6%</text><text class="cls-5" transform="translate(0.14 86.02)">9%</text><text class="cls-5" transform="translate(0.14 54.7)">12%</text><text class="cls-5" transform="translate(0.14 23.38)">15%</text><line class="cls-6" y1="181.73" x2="354.04" y2="181.73"/><line class="cls-7" x1="19.87" y1="184.19" x2="19.87" y2="181.45"/><line class="cls-7" x1="58.5" y1="184.19" x2="58.5" y2="181.45"/><line class="cls-7" x1="97.14" y1="184.19" x2="97.14" y2="181.45"/><line class="cls-7" x1="135.77" y1="184.19" x2="135.77" y2="181.45"/><line class="cls-7" x1="174.4" y1="184.19" x2="174.4" y2="181.45"/><line class="cls-7" x1="213.03" y1="184.19" x2="213.03" y2="181.45"/><line class="cls-7" x1="251.67" y1="184.19" x2="251.67" y2="181.45"/><line class="cls-7" x1="290.3" y1="184.19" x2="290.3" y2="181.45"/><line class="cls-7" x1="328.93" y1="184.19" x2="328.93" y2="181.45"/><text class="cls-8" transform="translate(10.24 191.84)">19−01</text><text class="cls-8" transform="translate(48.87 191.84)">19−05</text><text class="cls-8" transform="translate(87.5 191.84)">19−09</text><text class="cls-8" transform="translate(126.13 191.84)">20−01</text><text class="cls-8" transform="translate(164.76 191.84)">20−05</text><text class="cls-8" transform="translate(203.4 191.84)">20−09</text><text class="cls-8" transform="translate(242.03 191.84)">21−01</text><text class="cls-8" transform="translate(280.66 191.84)">21−05</text><text class="cls-8" transform="translate(319.29 191.84)">21−09</text><text class="cls-9" transform="translate(0.35 5.15)">UNEMPLOYMEN<tspan class="cls-10" x="47.01" y="0">T</tspan><tspan x="0" y="7.2">R</tspan><tspan class="cls-11" x="4.33" y="7.2">A</tspan><tspan x="7.89" y="7.2">TE</tspan></text><text class="cls-12" transform="translate(250.21 110.91)">Nationwide</text><text class="cls-13" transform="translate(58.5 114.27)">Nationwide Black</text><text class="cls-13" transform="translate(58.5 157.11)">Nationwide White</text><text class="cls-14" transform="translate(244.48 142.89)">Kentucky</text><text class="cls-15" transform="translate(156.98 160.73)">Short-term employment level bounced back rapidl<tspan class="cls-11" x="176.09" y="0">y</tspan><tspan x="179.5" y="0">, </tspan><tspan x="0" y="10">but structrual problem restrained further recovery</tspan></text><line class="cls-16" x1="216.84" y1="129.88" x2="213.03" y2="152.8"/></svg>
        <p class="source">Source: US Bureau of Labor Statistics </p>

        <br/><br/>

        <h2 class="headline">
            Reconsider the difficulty and priority of various goals
        </h2>

        <h3>
            We divide various goals for this funds to four categories based on their terms and aims. Harder tasks are colored deeper. However, not all tasks are of same importance. We must set priorites for our Kentucky case. We place higher priority on long-term goals and also focus more on social equity as the short-term recovery went well.
        </h3>
    </div>

    <div style="display:flex; justify-content:space-around;">

        <div id="boxTopLeft"></div>

        <div id="boxTop1">
            <h3>Recovery</h3>
        </div>

        <div id="boxTop2">
            <h3>Equity</h3>
        </div>
    </div>

    <div style="display:flex; justify-content:space-around;">

        <div class="boxLeft">
            <h3>Short-term</h3>
        </div>

        <div id="box1">
            <h4>
                <ul>Repayment of federal loan</ul>
                <ul>Payments to households</ul>
                <ul>Payments to business and NGO</ul>
                <ul>Investments in transportation</ul>
                <ul>Investments in education</ul>
                <ul>Investments in unemployment aids</ul>
            </h4>
        </div>

        <div id="box2">
            <h4>
                <ul>Payments and investments to underserved communities and households</ul>
                <ul>Investments in small business</ul>            
            </h4>
        </div>
    </div>

    <div style="display:flex; justify-content:space-around;">

        <div class="boxLeft">
            <h3>Long-term</h3>
        </div>

        <div id="box3">
            <h4>
                <ul>Investments in unemployment training program</ul>
                <ul>Investments in communities</ul>
                <ul>Investments in business</ul>
            </h4>
        </div>

        <div id="box4">
            <h4>
                <ul>Broadband expansion</ul>
                <ul>Investments in infrastructure</ul>
            </h4>
        </div>
    </div>

    <div class="chart-container">
        <br/><br/>

        <h2 class="headline">
            Plan on a pro-rata basis vs. Our new proposal
        </h2>

        <h3>
            We make a plan on a pro-rata basis according to the Governor's original plan by reducing all categories proportionally. We then adjust this plan based on our analysis for Kentucky's situation. Specifically,
            <br/><br/>
            1. We’ll invest in unemployment training programs and local vocational schools, trying to develop essential skills for those unemployed and underserved, and motivate the shadow labor force to join the labor force, and provide bonus for those working in essential positions and seriously affected industries.
            <br/><br/>
            2. Kentucky has a rather low level of home broadband connection usage rate, which is among the bottom of all states. During the pandemic, infrastructure construction in broadband plays a pivotal role since high-speed internet access is the basis of remote education, remote working, modern business and healthcare system. 
            <br/><br/>
            3. Bailey (2021) suggested using the state fiscal recovery funds to address children’s academic, social, emotional and mental health needs. According to Gordon & Reber (2020), Kentucky’s state aid to local school districts is slightly progressive, which is nearly the average level of all states. It’s more urgent and essential to deal with the short-term recovery, including back to school, additional tutoring and parent-directed compensatory education services and so on, rather than the long-term equity of education.
            <br/><br/>
            4. The daunting challenges we are facing are the long-term recovery and equity targets on which Kentucky perform poorly. We first increase the original amount for broadband expansion since it’s so essential for both long-term recovery and equity. Besides, for the long-term recovery part, we cut the water and wastewater infrastruture fund to provide aids to essential workers.
        </h3>

        <svg width="1050px" height="575px" id="svg3">
        </svg>
        <p class="source">Source: Courier Journal & Analysis by Xiaohan Kong</p>
        <br/><br/>

    </div>

</body>

<script src="https://d3js.org/d3.v6.min.js"></script>
<script src="https://unpkg.com/topojson@3"></script>

<script>

// Graph 1

    Promise.all([ 
        d3.json('state.json'),
    ])
        .then(ready)
        .catch((err) => {
            console.log(err);
        });

    function ready(res) {
        console.log(res[0])
        let raw = res[0]

        let points = topojson.feature(raw, raw.objects.points);
        let state = topojson.feature(raw, raw.objects.state);

        console.log(state)

        let width = 1050;
        let height = 500;

        let svg1 = d3.select('#svg1')

        let myProjection = d3.geoAlbersUsa()
            .fitSize([width, height], state)
            
        let path = d3.geoPath()
            .projection(myProjection)
            
        let innerlines = topojson.mesh(raw, raw.objects.state, function (a, b) {
            return a != b;
        });

        svg1
        .selectAll(".states")
        .data(state.features)
        .join("path")
        .attr("d", path)
        .style("fill", "#eee")
        .style("stroke", "none")
        .style("pointer-events", "none")

        let states = svg1
        .append("path")
        .attr("d", path(innerlines))
        .style("fill", "none")
        .style("stroke", "#ddd")
        .style("stroke-width", 1.5)
        .style("pointer-events", "none")

        let circles = svg1
        .selectAll(".points")
        .data(points.features)
        .join("circle")
        .attr("r", d => {
            return d.properties.resized
        })
        .attr("cx", d => {
            return path.centroid(d)[0]
        })
        .attr("cy", d => {
            return path.centroid(d)[1]
        })
        .attr("fill-opacity", d => {
            if (d.properties.STUSPS == "KY"){
                return "1"
            } else {
                return "0.3"
            }
        })
        .style("fill", d => {
            if (d.properties.STUSPS == "KY"){
                return "red"
            } else {
                return "orange"
            }
        })
        .style("stroke", d => {
            if (d.properties.STUSPS == "KY"){
                return "black"
            } else {
                return "none"
            }
        })
        .style("stroke-width", 3)

        svg1.append('text')
        .attr('x', width - 520)
        .attr('y', height - 200)
        .text("Kentucky's ARPA funds decreased to 2.183 billion dollars,")

        svg1.append('text')
        .attr('x', width - 440)
        .attr('y', height - 180)
        .text("Still ranked 27 among all states...")        
    }

// Graph 2

    Promise.all([ 
            d3.json('state.json'),
        ])
            .then(ready2)
            .catch((err) => {
                console.log(err);
            });

        function ready2(res2) {
            console.log(res2[0])
            let raw2 = res2[0]

            let points2 = topojson.feature(raw2, raw2.objects.points);
            let state2 = topojson.feature(raw2, raw2.objects.state);

            console.log(state2)

            let width = 1050;
            let height = 500;

            let svg2 = d3.select('#svg2')

            let myProjection2 = d3.geoAlbersUsa()
                .fitSize([width, height], state2)
                
            let path2 = d3.geoPath()
                .projection(myProjection2)
                
            let innerlines2 = topojson.mesh(raw2, raw2.objects.state, function (a, b) {
                return a != b;
            });

            svg2
            .selectAll(".states")
            .data(state2.features)
            .join("path")
            .attr("d", path2)
            .style("fill", "#eee")
            .style("stroke", "none")
            .style("pointer-events", "none")

            let states2 = svg2
            .append("path")
            .attr("d", path2(innerlines2))
            .style("fill", "none")
            .style("stroke", "#ddd")
            .style("stroke-width", 1.5)
            .style("pointer-events", "none")

            let circles2 = svg2
            .selectAll(".points")
            .data(points2.features)
            .join("circle")
            .attr("r", d => {
                return d.properties.share
            })
            .attr("cx", d => {
                return path2.centroid(d)[0]
            })
            .attr("cy", d => {
                return path2.centroid(d)[1]
            })
            .attr("fill-opacity", d => {
                if (d.properties.STUSPS == "KY"){
                    return "1"
                } else {
                    return "0.3"
                }
            })
            .style("fill", d => {
                if (d.properties.STUSPS == "KY"){
                    return "red"
                } else {
                    return "orange"
                }
            })
            .style("stroke", d => {
                if (d.properties.STUSPS == "KY"){
                    return "black"
                } else {
                    return "none"
                }
            })
            .style("stroke-width", 3)

            svg2.append('text')
            .attr('x', width - 490)
            .attr('y', height - 200)
            .text("However, this is only 5.5% of FY20 state spending,")

            svg2.append('text')
            .attr('x', width - 420)
            .attr('y', height - 180)
            .text("Ranked 48 among all states")  
        }

// Graph 3

    let svg3 = d3.select('#svg3')

        let width = 800;
        let height = 500;
        let margin = { top: 30, left: 120, right: 10, bottom: 30 };

        let data = [{
            "name": 'Aid to Impacted Industries',
            "value": 86,
            "negativeValue": -86
            }, {
            "name": 'COVID Additional Expenses for Testing, Mitigation, etc.',
            "value": 86,
            "negativeValue": -86         
            }, {
            "name": 'COVID Additional Expenses for Testing, Mitigation, etc.',
            "value": 100,
            "negativeValue": -207  
            }, {
            "name": 'Targeted Small Business Assistance',
            "value": 172,
            "negativeValue": -172   
            }, {
            "name": 'Water and Waste Infrastructure',
            "value": 215,
            "negativeValue": -430
            }, {
            "name": 'Aid to Targeted Industries & Essential Workers Bonus',
            "value": 221,
            "negativeValue": 0
            }, {
            "name": 'Broadband Expansion',
            "value": 250,
            "negativeValue": -215   
            }, {
            "name": 'Economic Impact Payments to Households & Investments in Education',
            "value": 475,
            "negativeValue": -409       
            }, {
            "name": 'Unemployment Insurance',
            "value": 575,
            "negativeValue": -575
        }];

        let x = d3.scaleLinear()
            .domain([-600, 600])
            .range([0, width]);

        let y = d3.scaleBand()
            .domain(data.map(d => d.name))
            .range([height, 0])
            .padding(0.5);

        let g = svg3
        .append('g')
        .attr('transform', `translate(${margin.left} ${margin.right})`);

        let positiveBars = g
        .selectAll('.positive')
        .data(data);

        positiveBars.exit().remove();
        positiveBars.enter()
        .append('rect')
        .attr('class', 'positive')
        .attr('fill',  d => {
            if(d.name == 'COVID Additional Expenses for Testing, Mitigation, etc.'|
            d.name == 'Water and Waste Infrastructure'
            ){
                return 'darkred'
            } else if (d.name == 'Economic Impact Payments to Households & Investments in Education'|
            d.name == 'Broadband Expansion'|
            d.name == 'Aid to Targeted Industries & Essential Workers Bonus'){
                return 'darkgreen'
            } else {
                return '#ddd'
            }
        })
        .merge(positiveBars)
        .attr('x', x(0))
        .attr('y', d => y(d.name))
        .attr('width', d => x(d.value) - x(0))
        .attr('height', y.bandwidth());

        let negativeBars = g
        .selectAll('.negative')
        .data(data);
        
        negativeBars.exit().remove();
        negativeBars.enter()
        .append('rect')
        .attr('class', 'negative')
        .attr('fill', '#ddd')
        .merge(negativeBars)
        .attr('x', d => x(d.negativeValue))
        .attr('y', d => y(d.name))
        .attr('width', d => x(0) - x(d.negativeValue))
        .attr('height', y.bandwidth());

        g.append('g')
        .attr('class', 'x-axis')
        .attr('transform', `translate(0, ${height})`)
        .call(d3.axisBottom(x).tickFormat(function (v){
            return Math.abs(v)
            })
        )

        g.append('g')
        .attr('class', 'y-axis')
        .attr('transform', `translate(${x(0)}, 0)`)
        .call(d3.axisLeft(y)) 

        g.append('text')
        .attr('x', width - 50)
        .attr('y', height + 40)
        .text('(Million Dollars)')

        g.append('text')
        .attr('x', width - 380)
        .attr('y', height + 40)
        .text('New Proposal')

        g.append('text')
        .attr('x', width - 590)
        .attr('y', height + 40)
        .text('Plan on a Pro-rata Basis')

        g.append('text')
        .attr('x', width - 220)
        .attr('y', height - 240)
        .text('Green shows allocating more')

        g.append('text')
        .attr('x', width - 220)
        .attr('y', height - 200)
        .text('Red shows allocating less')

</script>